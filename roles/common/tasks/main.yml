---
- name: "install common packages"
  become: true
  community.general.pacman:
    name:
      - btrfs-progs
      - efibootmgr
      - grub
      - man-db
      - man-pages
      - openssh
      - pbzip2
      - pigz
      - vim
    state: latest
    update_cache: true

- name: "ethernet config"
  become: true
  notify: "restart networking"
  copy:
    src: 20-ethernet.network
    dest: /etc/systemd/network/20-ethernet.network
    owner: root
    group: root
    mode: "0644"

- name: "makepkg config"
  become: true
  copy:
    src: makepkg.conf
    dest: /etc/makepkg.conf
    owner: root
    group: root
    mode: '0644'

- name: "create /etc/hostname"
  become: true
  ansible.builtin.copy:
    content: |
      # Generated by ansible at {{ ansible_date_time.iso8601 }}
      {{ hostname }}
    dest: /etc/hostname

- name: "create /etc/hosts"
  become: true
  ansible.builtin.template:
    src: templates/hosts.j2
    dest: /etc/hosts
    owner: root
    group: root
    mode: '0644'

- name: "uncomment locale"
  become: true
  notify: "locale setup"
  ansible.builtin.lineinfile:
    path: /etc/locale.gen
    line: "en_US.UTF-8 UTF-8"
    regexp: "^#en_US.UTF-8 UTF-8"

- name: "enable sshd"
  become: true
  ansible.builtin.systemd:
    name: sshd
    state: started
    enabled: true
